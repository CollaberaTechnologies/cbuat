
@using System.Web.Optimization
@using Kendo.Mvc.UI
@using Kendo.Mvc.Extensions


@{
    ViewBag.Title = "Pending";
    if (Session["uiid"] == null)
    {
        Response.Redirect("/account/login");
    }


}

<meta charset="utf-8" />

<link rel="icon" type="image/png" href="assets/img/favicon.ico">

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<title>Light Bootstrap Dashboard by Creative Tim</title>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
<meta name="viewport" content="width=device-width" />


<style>
    .collalogo {
        text-align: center;
        display: block;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
        padding: 5px 0px;
        display: block;
        font-size: 32px;
        color: white;
        text-align: center;
        font-weight: 300;
        line-height: 30px;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    }

    .session {
        color: black;
        margin-left: 46px;
    }

    .button {
        margin: -2px 3px;
        font-size: 14px;
        color: #333;
        background-color: #50b1fb;
        border-color: #ccc;
        display: inline-block;
        padding: 6px 12px;
        cursor: pointer;
        border: 1px solid transparent;
        border-radius: 4px;
    }

    .c1 {
        padding: 30px 15px;
        /*min-height: calc(100% - 123px);*/
        /*background-image: url('../../Content/themes/base/images/beverage-blank-break-997719.jpg');*/
        background-image: url('../../Content/themes/base/images/background-black-blank-733857.jpg');
        display: block;
        background-size: cover;
        min-height: 90vh;
    }

    .sidebar-wrapper1 {
        position: relative;
        max-height: calc(100vh - 75px);
        min-height: 100%;
        overflow: auto;
        width: 260px;
        z-index: 4;
        padding-bottom: 100px;
        background-color: #50b1fb;
    }
 .pop {
        right: auto;
        left: 33%;
        width: 800px;
        padding-top: 30px;
        padding-bottom: 30px;
        height: 800px;
        margin-top: 7%;
        overflow-x:scroll;
        overflow-y:scroll;
    } 
</style>

<link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
<link href="../assets/css/animate.min.css" rel="stylesheet" />
<link href="../assets/css/light-bootstrap-dashboard.css" rel="stylesheet" />
<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
<link href="../assets/css/pe-icon-7-stroke.css" rel="stylesheet" />
<link href="http://cdn.rawgit.com/davidstutz/bootstrap-multiselect/master/dist/css/bootstrap-multiselect.css"
      rel="stylesheet" type="text/css" />
<script src="http://cdn.rawgit.com/davidstutz/bootstrap-multiselect/master/dist/js/bootstrap-multiselect.js"></script>
<link href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css"
      rel="stylesheet" type="text/css" />
<script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>
<script src="http://cdn.kendostatic.com/2014.2.903/js/kendo.all.min.js"></script>
<!-- Magnific Popup core CSS file -->
<!-- jQuery 1.7.2+ or Zepto.js 1.0+ -->




@using (Html.BeginForm("Pending", "Dashboard", FormMethod.Post))
{
    @Html.AntiForgeryToken()

    <!--CLIENT VIEW-->
    <div class="wrapper ">
        <div class="sidebar" data-color="blue" data-image="assets/img/sidebar-5.jpg">
            <!--

                Tip 1: you can change the color of the sidebar using: data-color="blue | azure | green | orange | red | purple"
                Tip 2: you can also add an image using data-image tag

            -->

            <div class="sidebar-wrapper1">
                <div class="logo">
                    <a class="collalogo" href="/Dashboard/Dash">
                        Collabera
                    </a>
                </div>

                @*<div id="test-form" class="session">



                        <h5 style="font-weight:600;">Login Time:</h5><h5>@Session["Time"].ToString()</h5>

                    </div>*@

                <ul class="nav">
                    <li >
                        <a href="/Dashboard/Dashboard">
                            <i class="glyphicon glyphicon-dashboard"></i>
                            <p style="margin: 0; line-height: 30px;font-size: 16px;font-weight: 400;margin-left: 45px;text-transform:capitalize;">Dashboard</p>
                        </a>
                    </li>
                    <li class="active">
                        <a href="/Dashboard/Pending">
                            <i class="glyphicon glyphicon-hourglass"></i>
                            <p style="margin: 0; line-height: 30px;font-size: 16px;font-weight: 400;margin-left: 45px;text-transform:capitalize;">Pending</p>
                        </a>
                    </li>
                    <li>
                        <a href="/Dashboard/Approved">
                            <i class="glyphicon glyphicon-ok"></i>
                            <p style="margin: 0; line-height: 30px;font-size: 16px;font-weight: 400;margin-left: 45px;text-transform:capitalize;">Approved</p>
                        </a>
                    </li>
                    <li>
                        <a href="/Dashboard/rejected">
                            <i class="glyphicon glyphicon-ban-circle"></i>
                            <p style="margin: 0; line-height: 30px;font-size: 16px;font-weight: 400;margin-left: 45px;text-transform:capitalize;">Rejected</p>
                        </a>
                    </li>
                    @if (Session["status"].ToString().Equals("1"))
                    {
                    }
                    else
                    {
                        <li>

                            <a href="/Dashboard/NewBlock">
                                <i class="glyphicon glyphicon-plus"></i>
                                <p style="margin: 0; line-height: 30px;font-size: 16px;font-weight: 400;margin-left: 45px;text-transform:capitalize;">New Block</p>
                            </a>
                        </li>
                    }
                    <li>
                        <a href="/Account/ResetPassword">
                            <i class="glyphicon glyphicon-lock"></i>
                            <p style="margin: 0; line-height: 30px;font-size: 16px;font-weight: 400;margin-left: 45px;text-transform:capitalize;">Change Password</p>
                        </a>
                    </li>
                    <li>
                        <a href='/account/logout'>
                            <i class="glyphicon glyphicon-off"></i>
                            <p style="margin: 0; line-height: 30px;font-size: 16px;font-weight: 400;margin-left: 45px;text-transform:capitalize;">Log out</p>
                        </a>
                    </li>


                </ul>
            </div>
        </div>
        <div class="main-panel">

            <nav class="navbar navbar-default navbar-fixed">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example-2">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <div class="navbar-brand">
                            <div class="container">
                                <div class="row">
                                    <div class="col-md-12">
                                        @*<input id="products" class="col-md-12" placeholder="Search for ConsultantName &amp; Email ID..." />*@
                                        @*<input type="button" id="btnSearch" class="glyphicon glyphicon-search"/>*@
                                        <input id="companyName" list="companyList" class="col-md-8" placeholder="Search for ConsultantName &amp; Email ID..." />
                                        <datalist id="companyList"></datalist>
                                        <button type="button" id="btnSearch" class="button">
                                            <span class="glyphicon glyphicon-search"></span>
                                        </button>

                                        
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="collapse navbar-collapse">

                        <ul class="nav navbar-nav navbar-right">
                            @*<li>

                                    <a href="/Dashboard/NewBlock" style="color:blue;">
                                        NewBlock
                                    </a>
                                </li>*@
                            <li>
                                <p>
                                    <label>@Session["uid"].ToString()</label>
                                    @*<br />
                                    @if (Session["rights"] != null)
                                    {
                                        <label>Reports to: @Session["rights"].ToString()</label>
                                    }*@

                                </p>
                            </li>

                            <li class="separator hidden-lg"></li>
                        </ul>
                    </div>
                </div>
            </nav>
            <div id="DOC1"></div>  
            @Html.Hidden("data", ViewBag.name as string)
            @Html.Hidden("emildata", ViewBag.email as string)
            <div class="c1">
                <div class="container-fluid">

                   
                    <div class="col-md-12">
                        <div class="panel panel-primary list-panel" id="list-panel">
                            <div class="panel-heading list-panel-heading">
                                <h1 class="panel-title list-panel-title">Pending Consultants List</h1>
                            </div>

                            <div id="example"></div>
                        </div>
                    </div>



                    <!--Griddddddddddd-->

                </div>
            </div>




        </div>
    </div>
    <div class="col-sm-12 col-md-10 col-md-offset-1">
        <div class="modal" id='myModalts'>
            <div class="panel panel-primary modal-dialog col-sm-12 col-md-10 col-md-offset-1 pop" style="margin-top:4%;margin-left:5%;height:800px;width:800px">

                <div class="panel-heading"style="margin-top: -30px;margin-left: -10px;margin-right: -10px;font-weight:bold;font-size:22px;" 
 
>
                    Search
                    @*<button type="submit" class="close" aria-hidden="true">×</button>*@
                </div>
                <div class="panel-body">
                    <div id='myModalContentty'></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-12 col-md-10 col-md-offset-1">
        <div class="modal" id='myModalt'>
            <div class="panel panel-primary modal-dialog col-sm-12 col-md-10 col-md-offset-1 pop"style="margin-top:4%;margin-left:5%;height:800px;width:800px" 
 
>

                <div class="panel-heading"style="margin-top: -30px;margin-left: -10px;margin-right: -10px;font-weight:bold;font-size:22px;">
                    Details
                </div>
                <div class="panel-body">
                    <div id='myModalContenty'></div>
                </div>
            </div>
        </div>
    </div>
}
<link href="~/Content/kendo/kendo.blueopal.min.css" rel="stylesheet" />
<script src="https://kendo.cdn.telerik.com/2018.2.620/js/kendo.all.min.js"></script>
<script src="http://kendo.cdn.telerik.com/2018.2.620/js/jszip.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert-dev.js"></script>
<!--MailCode-->

<script>
    var selectitem=[];
    function createTemplateFor(columnName) {
        var template = "# var address = data['" + columnName + "']; #" +
            "# var splitaddr = address.split(','); #" +
            "# for (var i = 0; i < splitaddr.length; i++) { #" +
          
            " <br><a href='/uploadimage/#=splitaddr[i] #'>#=splitaddr[i] #</a>" +
            "# } #";

        return template;
    }
    function msg(filename){
        debugger;
        alert(filename);
        var filename=filename;
        $("#DOC1").empty();
        var frame= "<iframe src='/Dashboard/DownloadFile?fileName='"+ filename + "</iframe>";
        $("#DOC1").html(frame);
         $("#DOC1").show();  
        
    
    };
    $(document).ready(function () {
       
        $("#companyName").on("input", function () {
            var options = {};
            options.url = "/Dashboard/search";
            options.type = "GET";

            options.dataType = "json";
            options.success = function (data) {
                $("#companyList").empty();
                for(var i=0;i<data.length;i++)
                {
                    $("#companyList").append("<option value='" +
                    data[i].Text + "'></option>");
                }
            };
            $.ajax(options);
        });

        var data = "/Dashboard/DownloadFile?fileName=" + "Desert.jpg" + "";

        $(function () {
            var values = new Array();
            @foreach (var item in ViewBag.VALUE)
                       {

                     @:values.push({ RID: "@item.RID", Fname: "@item.Fname", EmailId: "@item.EmailId", CreatedDate: "@item.CreatedDate", Username: "@item.Username",Imagepath:"@item.Imagepath ",Requirement_Name:"@item.Requirement_Name",ClientName:"@item.ClientName",PNumber:"@item.PNumber",CLocation:"@item.CLocation" });

                        }
            if (@ViewBag.hide==1) {
                debugger;
                var value= $("#data").val();
                var valueemail= $("#emildata").val();

                dataSource = new kendo.data.DataSource({
                    data:values,
                    pageSize:20,
                    filter:[ { field: "Fname", operator: "contains", value:value  },
                        { field: "EmailId", operator: "contains", value:valueemail  }
                    ]




                });

                $("#example").kendoGrid({
                    toolbar: ["excel"],
                    excel: {
                        fileName: "Closing_Block_Pending.xlsx",
                        URL: "http://localhost:57276/Clients/GetAllGridData",
                        filterable: true,
                        allPages:true
                    },


                    columns: [
                        { title: "Name", field: "Fname" },
                    { title: "EmailId", field: "EmailId" },
                      { title: "Contact Number", field: "PNumber" },
                        { title: "Location", field: "CLocation" },
                       { title: "Client", field: "ClientName" },
                      { title: "Requirement", field: "Requirement_Name" },
                    { title: "Username", field: "Username" },
                     { title: "CreatedDate", field: "CreatedDate" },
                   { hidden:true , field: "RID" },
                    { hidden:true , field: "Imagepath" },
                    { title: "Action", template: "<span class='glyphicon glyphicon-ok' aria-hidden='true' data-toggle='tooltip' title='Approve'onclick=\"approve(#=RID#)\"></span>    <span class='glyphicon glyphicon-ban-circle' aria-hidden='true' data-toggle='tooltip' title='Reject' style='margin-left:13px;' onclick=\"reject(#=RID#)\"></span> <span class='glyphicon glyphicon-file aria-hidden='true' data-toggle='tooltip' title='Details'style='margin-left:13px;' onclick=\"PopUp('#=RID#')\">" ,
                        filterable: false,
                        sortable:false},
                          { title: "File",template: createTemplateFor("Imagepath")}
                    ],

                    dataSource: dataSource,

                    height: 800,
                    scrollable: true,
                    pageable: true,
                    sortable: {
                        mode: "multiple"
                    },
                    groupable:true,
                    filterable: true,
                    reorderable: true,
                    resizable: true,

                    change: function (e) {
                        debugger;
                        var selectedRows = this.select();

                        var selectdate = [];
                        for (var i = 0; i < selectedRows.length; i++) {
                            var dataItem = this.dataItem(selectedRows[i]);
                            selectdate.push(dataItem.RID)

                            console.log(selectdate);

                        }
                        selectitem=selectdate;
                    }

                });

            }
            else{
                debugger;
                var value= $("#data").val();
                var valueemail= $("#emildata").val();

                dataSource = new kendo.data.DataSource({
                    data:values,
                    pageSize:20,
                    filter:[ { field: "Fname", operator: "contains", value:value  },
                        { field: "EmailId", operator: "contains", value:valueemail  }
                    ]


                });
                $("#example").kendoGrid({
                    toolbar: ["excel"],
                    excel: {
                        fileName: "Closing_Block_Pending.xlsx",
                        URL: "http://localhost:57276/Clients/GetAllGridData",
                        filterable: true,
                        allPages:true
                    },


                    columns: [
                        { title: "Fname", field: "Fname" },
                    { title: "EmailId", field: "EmailId" },
                     { title: "Contact Number", field: "PNumber" },
                        { title: "Location", field: "CLocation" },
                    { title: "ClientName", field: "ClientName" },
                { title: "Requirement_Name", field: "Requirement_Name" },
                //{ title: "Username", field: "Username" },
                 { title: "CreatedDate", field: "CreatedDate" },
                  { hidden:true , field: "Imagepath" },
                   { title: "Action", template: " <span class='glyphicon glyphicon-file aria-hidden='true' data-toggle='tooltip' title='Details'style='margin-left:13px;' onclick=\"PopUp('#=RID#')\">"},
                    { title: "File",template: createTemplateFor("Imagepath")}],


                    dataSource: dataSource,


                    height: 800,
                    scrollable: true,
                    pageable: true,
                    sortable: {
                        mode: "multiple"
                    },
                    groupable:true,
                    filterable: true,
                    reorderable: true,
                    resizable: true,


                });
            }




        });
        $("#btnSearch").click(function () {
            debugger;

            var id1 =$("#companyName").val();

            var options = { "backdrop": "static", keyboard: true };
            openpop(id1, options);


        });
    });

    function openpop(id1,options) {


        $.ajax({
            type: "GET",
            url: "/Dashboard/getstatus",
            contentType: "application/json ",
            data: { id: id1 },
            success: function (data) {

                debugger;
                $('#myModalContentty').html(data);
                $('#myModalts').modal('toggle');
                $('#myModalts').modal(options);
                $('#myModalts').modal('show');

            }
        });


    }





    function approve(RID) {
        debugger;
        $.ajax({
            type: "GET",
            url: "/Dashboard/Approve",
            contentType: "application/json ",
            data: { slectitem : RID },
            success: function (data) {
                swal({
                    title:"Entry Approved!",
                    type:"success",confirmButtonText: "OK",
                    closeOnConfirm: false
                },
           function(isConfirm){
               window.location.replace("Pending");
           });


            }
        });
    }


    //function openPopUp(RID) {
    //    debugger;
    //    var id = RID;
    //    if (confirm('Are you sure you want to delete?'))
    //    {
    //        $.ajax({
    //            type: "GET",
    //            url: "/Dashboard/Delete",
    //            contentType: "application/json ",
    //            data: { clid: id },
    //            success: function (data1) {
    //                alert("Entry Has Been Deleted");
    //                window.location.replace("Pending");
    //            }
    //        });
    //    }
    //    else {
    //        window.location.replace("Pending");
    //    }
    //}


    function reject(RID) {
        debugger;
        var id = RID;
        swal({
            title: "Reason For Reject",
            type: "input",
            showCancelButton: true,
            closeOnConfirm: false,
            inputPlaceholder: "enter the reason"
        }, function (inputValue) {
            if (inputValue === false) return false;
            if (inputValue === "") {
                swal.showInputError("You need to write something!");
                return false
            }
            //var val = document.getElementById(inputValue).value;
            $.ajax({
                type: "GET",
                url: "/Dashboard/Reject",
                contentType: "application/json ",
                data: { clid: id,text:inputValue },
                success: function (data) {
                    swal({
                        title:"Entry Rejected!",
                        type:"success",confirmButtonText: "OK",
                        closeOnConfirm: false
                    },
                    function(isConfirm){
                        window.location.replace("Pending");
                    });
                }
            });

        });
        //function (inputValue) {
        //

        //});


    }







    function PopUp(RID) {
        debugger;
        var id = RID;
        var options = { "backdrop": "static", keyboard: true };

        $.ajax({
            type: "GET",
            url: "/Dashboard/Details",
            contentType: "application/json ",
            data: { clid:id},
            success: function (data1) {
                $('#myModalContenty').html(data1);
                $('#myModalt').modal(options);
                $('#myModalt').modal('show');
            }
        });

    }
</script>